<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quản lý tin tức - Travelee Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/admin/css/dashboard-style.css}">
    <link rel="stylesheet" th:href="@{/admin/css/article-style.css}">

</head>
<body>
    <div class="dashboard-container">
        <div th:replace="~{/admin/fragments/header :: header}"></div>

        <!-- Sidebar -->
        <div th:replace="~{/admin/fragments/sidebar :: aside}"></div>

        <main class="main-content">
            <div class="article-table-container">
                <div class="article-table-header">
                    <div class="article-table-title">Quản lý tin tức</div>
                    <div class="article-table-actions">
                        <a th:href="@{/admin/article/create}" class="create-article-btn">
                            <i class="fa-solid fa-newspaper"></i> Tạo bài viết
                        </a>
                        <form class="article-search-form" method="get" th:action="@{/admin/article/list}">
                            <input type="text" name="keyword" placeholder="Tìm kiếm bài viết..." th:value="${keyword}">
                            <input type="hidden" name="size" th:value="${size}" />
                            <button type="submit"><i class="fas fa-search"></i></button>
                        </form>
                    </div>
                </div>
                <table class="article-table" th:if="${articles != null and !articles.isEmpty()}">
                    <thead>
                        <tr>
                            <th>STT</th>
                            <th>Hình ảnh</th>
                            <th>Tiêu đề</th>
                            <th>Danh mục</th>
                            <th>Ngày đăng</th>
                            <th>Người đăng</th>
                            <th>Trạng thái</th>
                            <th>Thao tác</th>
                        </tr>
                    </thead>
                    <tbody>
                    <tr th:each="article, iterStat : ${articles}">
                        <td th:text="${(currentPage * size) + iterStat.index + 1}">1</td>
                        <td>
                            <img th:if="${article.thumbnail != null and article.thumbnail != ''}" 
                                 th:src="@{${article.thumbnail}}" 
                                 style="width: 80px; height: auto;" 
                                 alt="Thumbnail" />
                            <span th:if="${article.thumbnail == null or article.thumbnail == ''}" 
                                  style="color: #999; font-style: italic;">Không có ảnh</span>
                        </td>
                        <td>
                            <span th:if="${article.title != null}" th:text="${article.title}"></span>
                            <span th:unless="${article.title != null}">Không có tiêu đề</span>
                        </td>
                        <td>
                            <span th:if="${article.categories != null and !article.categories.isEmpty()}" 
                                  th:each="cat : ${article.categories}" 
                                  th:text="${cat.name}" 
                                  style="margin-right: 5px; display: inline-block; background: #f0f0f0; padding: 2px 6px; border-radius: 3px; font-size: 0.8em;"></span>
                            <span th:if="${article.categories == null or article.categories.isEmpty()}" 
                                  style="color: #999; font-style: italic;">Chưa phân loại</span>
                        </td>
                        <td>
                            <span th:if="${article.createdAt != null}" th:text="${#temporals.format(article.createdAt, 'dd/MM/yyyy')}"></span>
                            <span th:unless="${article.updatedAt != null}" th:text="${#temporals.format(article.updatedAt, 'dd/MM/yyyy')}"></span>
                        </td>
                        <td>
                            <span th:if="${article.user != null and article.user.fullName != null}" th:text="${article.user.fullName}"></span>
                            <span th:unless="${article.user != null and article.user.fullName != null}">N/A</span>
                        </td>
                        <td>
                            <span th:if="${article.status != null and article.status.name() == 'ACTIVE'}" class="status-active" th:text="'Hoạt động'"></span>
                            <span th:if="${article.status != null and article.status.name() != 'ACTIVE'}" class="status-inactive" th:text="'Tạm ngưng'"></span>
                        </td>
                        <td class="article-actions">
                            <a th:href="@{'/admin/article/view/' + ${article.id}}" class="action-btn view">
                                <i class="fas fa-eye"></i> Xem
                            </a>
                            <a th:href="@{'/admin/article/edit/' + ${article.id}}" class="action-btn edit">
                                <i class="fas fa-edit"></i> Sửa
                            </a>
                            <a th:href="@{'/admin/article/delete/' + ${article.id}}" class="action-btn delete" onclick="return confirm('Bạn có chắc chắn muốn xóa?')">
                                <i class="fas fa-trash"></i> Xóa
                            </a>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <!-- Thông báo khi không có dữ liệu -->
                <div th:if="${articles == null or articles.isEmpty()}" 
                     style="text-align: center; padding: 40px; color: #666; font-style: italic;">
                    <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; display: block;"></i>
                    <p>Chưa có bài viết nào được tạo</p>
                    <a th:href="@{/admin/article/create}" 
                       style="display: inline-block; margin-top: 1rem; padding: 10px 20px; background: #667eea; color: white; text-decoration: none; border-radius: 5px;">
                        <i class="fas fa-plus"></i> Tạo bài viết đầu tiên
                    </a>
                </div>
                <div class="article-table-footer" style="display: flex; justify-content: space-between; align-items: center; margin-top: 24px;" th:if="${articles != null and !articles.isEmpty()}">
                    <div class="article-total-count" style="font-weight: 500; color: #667eea;">
                        <span th:text="'Tổng cộng ' + ${totalItems} + ' bài viết'"></span>
                    </div>
                    <!-- Góc phải: Phân trang -->
                    <div class="admin-pagination">
                        <a th:if="${currentPage > 0 and totalPages > 0}"
                           th:href="@{/admin/article/list(page=${currentPage - 1}, size=${size}, keyword=${keyword})}"
                           class="admin-page-btn prev"
                           title="Trang trước">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                        <span class="admin-page-numbers" th:if="${totalPages > 0}">
                            <a th:each="i : ${#numbers.sequence(0, (totalPages - 1))}"
                               th:href="@{/admin/article/list(page=${i}, size=${size}, keyword=${keyword})}"
                               th:text="${i+1}"
                               th:classappend="${i == currentPage} ? 'admin-page-btn active' : 'admin-page-btn'">
                            </a>
                        </span>
                        <a th:if="${currentPage < (totalPages - 1) and totalPages > 0}"
                           th:href="@{/admin/article/list(page=${currentPage + 1}, size=${size}, keyword=${keyword})}"
                           class="admin-page-btn next"
                           title="Trang tiếp">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                        <form method="get" action="/admin/article/list" style="margin-left: 16px; display: flex; align-items: center;">
                            <select name="size" th:value="${size}" class="admin-page-btn" style="min-width: 60px; margin-right: 6px;">
                                <option value="5" th:selected="${size == 5}">5</option>
                                <option value="10" th:selected="${size == 10}">10</option>
                                <option value="15" th:selected="${size == 15}">15</option>
                                <option value="20" th:selected="${size == 20}">20</option>
                            </select>
                            <input type="hidden" name="page" th:value="${currentPage}" />
                            <input type="hidden" name="keyword" th:value="${keyword}" />
                            <button type="submit" class="admin-page-btn" style="padding: 8px 12px;">Chọn</button>
                        </form>
                    </div>
                </div>
            </div>
        </main>

    </div>
</body>
</html>